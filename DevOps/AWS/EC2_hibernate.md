# EC2 Hibernate란?
영어 Hibernate는 동면을 의미합니다. 이러한 맥락으로 EC2 Hibernate는 우리가 흔히 아는 최대절전모드를 의미합니다. Hibernate와 인스턴스 중지, 종료와 다른 점은 EC2 인스턴스의 인메모리 상태가 유지되는 여부입니다.

### 인스턴스 중지, 종료, hibernate 차이
| 유형 | 설명 |
| --- | --- |
| 중지 - stop | 인스턴스 중지는 우리가 사용하는 컴퓨터를 종료하는 것과 동일합니다. EBS 볼륨의 데이터는 다음 부팅 때까지 유지되지만 메모리의 데이터는 모두 소실됩니다. |
| 종료 - terminate | 인스턴스 종료는 인스턴스와 연결된 EBS 볼륨(특히 Root 볼륨)은 삭제되고 그렇지 않은 볼륨은 그대로 유지됩니다. 일반적으로는 인스턴스 종료와 함께 EBS 볼륨이 삭제되지만 EBS 볼륨 중 종료 시 삭제 옵션이 비활성화 된 볼륨은 인스턴스 종료 후에도 유지됩니다. |
| 최대절전모드 - hibernate | 최대절전모드가 실행되기 직전의 인메모리 상태가 인스턴스와 연결된 루트 EBS 볼륨에 기록되어 유지됩니다. |

### Hibernate

<img src="/images/EC2_hibernate.png" width="50%" height="50%" title="ec2 hibernate" alt="ec2 hibernate">    

- RAM에 있던 인메모리 상태는 그대로 보존된다.
- OS가 중지되는 것이 아니므로 인스턴스의 부팅이 매우 빨라진다.
- RAM에 있는 인메모리 상태는 Root 경로의 EBS 볼륨에 기록되므로 루트 EBS 볼륨은 암호화해야 하고 볼륨 용량도 RAM을 저장하기에 충분해야한다.
- Use Cases
    - 오랫동안 실행되어야 하는 프로세스를 중지하지 않아야 할 때
    - RAM 상태를 저장하고 싶을 때
    - 빠르게 재부팅을 하고 싶을 때
- 지원하는 사양
    - 인스턴스 유형 : C3, C4, C5, I3, M3, M4, R3, R4, T2, T3, …
    - 인스턴스 RAM 용량 : 150GB 미만
    - 인스턴스 크기 : 배어 메탈 인스턴스는 지원하지 않는다.
        - 베어메탈 : 가상화를 사용하지 않고 물리적으로 분리된 컴퓨팅 자원
    - AMI : Amazon Linux 2, Linux AMI, Ubuntu, RHEL, CentOS & Windows …
    - Root Volume : 루트 볼륨은 반드시 EBS이고 암호화되어야 하며 RAM을 덤프할 수 있을 만큼의 용량이 필요하다.
    - On-Demand, Reserverd, Spot, 모든 종류의 인스턴스에서 사용할 수 있다.
    - 최대 60일까지 사용 가능

### Hibernate 사용

- EC2 인스턴스를 생성할 때 고급 세부 정보에서 최대 절전 중지 방식 - 활성화 선택
- 스토리지 설정에서 EBS 볼륨 암호화 설정
- 볼륨 용량이 인스턴스 유형의 RAM 용량을 담을 만큼 충분한지 확인 후 용량 변경
- 인스턴스 상태를 인스턴스 최대 절전 모드로 선택 - 최대 절전 모드가 될 때까지 다소 시간이 소요된다.